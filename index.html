<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ApexCare â€“ Ø§Ù„Ù…Ø´Ø±ÙØ©</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#f0f4f8;--surface:#ffffff;--border:#dde3ec;
  --accent:#1d4ed8;--accent-h:#1e40af;
  --success:#16a34a;--warn:#d97706;--danger:#dc2626;
  --text:#1e293b;--muted:#64748b;--radius:12px;
}
body{font-family:'Tajawal',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}

/* â”€â”€ HEADER â”€â”€ */
header{
  background:var(--accent);color:#fff;
  padding:14px 24px;display:flex;align-items:center;
  justify-content:space-between;gap:12px;flex-wrap:wrap;
}
header h1{font-size:1.15rem;font-weight:800;display:flex;align-items:center;gap:8px}
header a{color:rgba(255,255,255,.8);text-decoration:none;font-size:.82rem;
  border:1px solid rgba(255,255,255,.4);padding:6px 14px;border-radius:7px;
  transition:.2s}
header a:hover{background:rgba(255,255,255,.15)}

/* â”€â”€ LOGIN SCREEN â”€â”€ */
#loginScreen{
  max-width:380px;margin:80px auto 0;background:var(--surface);
  border:1px solid var(--border);border-radius:var(--radius);
  padding:36px 32px;box-shadow:0 4px 24px rgba(0,0,0,.08);
  text-align:center;
}
#loginScreen h2{font-size:1.2rem;font-weight:800;margin-bottom:6px}
#loginScreen p{font-size:.85rem;color:var(--muted);margin-bottom:24px}
#loginScreen input{
  width:100%;padding:11px 14px;border:1.5px solid var(--border);
  border-radius:10px;font-family:'Tajawal',sans-serif;font-size:1rem;
  text-align:center;letter-spacing:3px;margin-bottom:12px;
  transition:.2s;direction:ltr;
}
#loginScreen input:focus{outline:none;border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(29,78,216,.12)}
#loginScreen input.shake{animation:shake .35s ease}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
#loginError{color:var(--danger);font-size:.82rem;margin-bottom:10px;display:none}

/* â”€â”€ MAIN â”€â”€ */
#mainContent{display:none;max-width:820px;margin:0 auto;padding:28px 16px 60px}
.page-head{margin-bottom:22px}
.page-head h2{font-size:1.35rem;font-weight:800}
.page-head p{color:var(--muted);font-size:.85rem;margin-top:3px}

/* â”€â”€ CARD â”€â”€ */
.card{background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius);padding:22px;margin-bottom:18px;
  box-shadow:0 1px 6px rgba(0,0,0,.06)}
.card-title{font-size:.9rem;font-weight:700;color:var(--accent);
  margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:6px}

/* â”€â”€ FORM â”€â”€ */
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
.grid-3{grid-template-columns:repeat(3,1fr)}
.grid-2{grid-template-columns:repeat(2,1fr)}
.full{grid-column:1/-1}
.field{display:flex;flex-direction:column;gap:5px}
label{font-size:.78rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.4px}
label .req{color:var(--danger)}
input[type=text],input[type=date],input[type=number],select{
  padding:9px 12px;border:1.5px solid var(--border);border-radius:9px;
  font-family:'Tajawal',sans-serif;font-size:.93rem;color:var(--text);
  background:#fff;width:100%;transition:.2s;
}
input:focus,select:focus{outline:none;border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(29,78,216,.1)}
input.err,select.err{border-color:var(--danger)}
.err-msg{font-size:.75rem;color:var(--danger);display:none}
.err-msg.show{display:block}

/* Yes/No toggle */
.toggle{display:flex;border:1.5px solid var(--border);border-radius:9px;overflow:hidden;height:40px}
.toggle input[type=radio]{display:none}
.toggle label{
  flex:1;display:grid;place-items:center;cursor:pointer;
  font-size:.88rem;font-weight:700;color:var(--muted);
  transition:.15s;text-transform:none;letter-spacing:0;
}
.toggle input[value="no"]:checked  + label{background:#dcfce7;color:var(--success)}
.toggle input[value="yes"]:checked + label{background:#fee2e2;color:var(--danger)}

/* Submit */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:7px;
  padding:11px 28px;border:none;border-radius:10px;cursor:pointer;
  font-family:'Tajawal',sans-serif;font-size:.95rem;font-weight:700;
  transition:.18s;
}
.btn-primary{background:var(--accent);color:#fff;width:100%;margin-top:6px}
.btn-primary:hover{background:var(--accent-h)}
.btn-primary:disabled{opacity:.5;cursor:not-allowed}
.btn-login{background:var(--accent);color:#fff;width:100%;padding:12px}
.btn-login:hover{background:var(--accent-h)}

/* Spinner */
.spin{width:18px;height:18px;border:2px solid rgba(255,255,255,.3);
  border-top-color:#fff;border-radius:50%;animation:rot .6s linear infinite;display:none}
@keyframes rot{to{transform:rotate(360deg)}}
.loading .spin{display:block}
.loading .btn-txt{display:none}

/* â”€â”€ KPI STRIP â”€â”€ */
#kpiStrip{display:none;margin-bottom:18px}
.kpi-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:12px}
.kpi{background:var(--surface);border:1px solid var(--border);border-radius:10px;
  padding:14px;text-align:center}
.kpi-lbl{font-size:.72rem;color:var(--muted);font-weight:700;text-transform:uppercase;letter-spacing:.4px;margin-bottom:6px}
.kpi-val{font-size:1.5rem;font-weight:800}
.kpi.ok  .kpi-val{color:var(--success)}
.kpi.warn .kpi-val{color:var(--warn)}
.kpi.bad  .kpi-val{color:var(--danger)}
.kpi.info .kpi-val{color:var(--accent)}

/* Alerts */
.alert{display:flex;align-items:flex-start;gap:9px;padding:10px 13px;
  border-radius:9px;font-size:.86rem;margin-bottom:8px}
.alert.warn{background:#fffbeb;border:1px solid #fcd34d;color:#92400e}
.alert.bad {background:#fef2f2;border:1px solid #fca5a5;color:#991b1b}
.alert.ok  {background:#f0fdf4;border:1px solid #86efac;color:#166534}

/* â”€â”€ TOAST â”€â”€ */
#toast{
  position:fixed;bottom:22px;left:50%;
  transform:translateX(-50%) translateY(70px);
  background:#1e293b;color:#fff;border-radius:10px;
  padding:12px 22px;font-size:.88rem;font-weight:600;
  box-shadow:0 4px 20px rgba(0,0,0,.25);z-index:999;
  transition:transform .3s cubic-bezier(.34,1.56,.64,1);
  max-width:340px;width:90%;text-align:center;
}
#toast.show{transform:translateX(-50%) translateY(0)}
#toast.ok  {background:#166534}
#toast.err {background:#991b1b}

@media(max-width:600px){
  .grid-3,.grid-2{grid-template-columns:1fr}
}
</style>
</head>
<body>

<header>
  <h1>ğŸ“ ApexCare â€“ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø±ÙØ©</h1>
  <a href="quality.html">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©</a>
</header>

<!-- â•â• LOGIN â•â• -->
<div id="loginScreen">
  <h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
  <p>Ø£Ø¯Ø®Ù„ <b>Ø±Ù…Ø² Ø§Ù„Ù…Ø´Ø±ÙØ©</b> Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
  <div id="loginError">Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­</div>
  <input type="password" id="keyInput" placeholder="Ø±Ù…Ø² Ø§Ù„Ù…Ø´Ø±ÙØ©" autocomplete="off" maxlength="40">
  <button class="btn btn-login" onclick="doLogin()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- â•â• MAIN â•â• -->
<div id="mainContent">
  <div class="page-head">
    <h2>ğŸ“‹ ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ</h2>
    <p>Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙØ©</p>
  </div>

  <!-- KPI Strip -->
  <div id="kpiStrip">
    <div class="card">
      <div class="card-title">ğŸ“Š Ù…Ø¤Ø´Ø±Ø§Øª Ø¢Ø®Ø± Ø¥Ø¯Ø®Ø§Ù„</div>
      <div class="kpi-row" id="kpiRow"></div>
      <div id="alertsArea" style="margin-top:14px"></div>
    </div>
  </div>

  <form id="reportForm" novalidate>
    <!-- Basic Info -->
    <div class="card">
      <div class="card-title">ğŸ“… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div>
      <div class="grid grid-3">
        <div class="field">
          <label>Ø§Ù„ØªØ§Ø±ÙŠØ® <span class="req">*</span></label>
          <input type="date" id="f-date">
          <span class="err-msg" id="e-date">Ù…Ø·Ù„ÙˆØ¨</span>
        </div>
        <div class="field">
          <label>Ø§Ù„ÙØ±Ø¹ <span class="req">*</span></label>
          <select id="f-branch">
            <option value="">Ø§Ø®ØªØ±...</option>
            <option value="Ù…Ø±ÙƒØ² Ø§Ù„Ø§ØªØµØ§Ù„">Ù…Ø±ÙƒØ² Ø§Ù„Ø§ØªØµØ§Ù„</option>
            <option value="Ø¹Ù†ÙŠØ²Ø©">Ø¹Ù†ÙŠØ²Ø©</option>
          </select>
          <span class="err-msg" id="e-branch">Ù…Ø·Ù„ÙˆØ¨</span>
        </div>
        <div class="field">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸ÙØ© <span class="req">*</span></label>
          <input type="text" id="f-agent" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
          <span class="err-msg" id="e-agent">Ù…Ø·Ù„ÙˆØ¨</span>
        </div>
      </div>
    </div>

    <!-- Calls -->
    <div class="card">
      <div class="card-title">ğŸ“± Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª</div>
      <div class="grid grid-2">
        <div class="field">
          <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø© </label>
          <input type="number" id="f-total" min="0" value="0">
          <span class="err-msg" id="e-total">Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­</span>
        </div>
        <div class="field">
          <label>Ø§Ù„Ù…Ø¬Ø§Ø¨ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ø¨ Ø¹Ù„ÙŠÙ‡Ø§</label>
          <input type="number" id="f-answered" min="0" value="0">
          <span class="err-msg" id="e-answered">ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† â‰¤ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
        </div>
        <div class="field">
          <label>Ø¹Ø¯Ø¯ Ù…ÙƒØ§Ù„Ù…Ø§Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ </label>
          <input type="number" id="f-cbc" min="0" value="0">
          <span class="err-msg" id="e-cbc">Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­</span>
        </div>
        <div class="field">
          <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø¯Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„(Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚) </label>
          <input type="number" id="f-cbm" min="0" value="0">
          <span class="err-msg" id="e-cbm">Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­</span>
        </div>
        <div class="field">
          <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª Ø§Ù„ØªÙŠ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙŠÙˆÙ…</label>
          <input type="number" id="f-unanswered" min="0" value="0">
          <span class="err-msg" id="e-unanswered">Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­</span>
        </div>
      </div>
    </div>

    <!-- Issues -->
    <div class="card">
      <div class="card-title">âš ï¸ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª</div>
      <div class="grid grid-2">
        <div class="field">
          <label>Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª ØŸ</label>
          <div class="toggle">
            <input type="radio" name="callIssues" id="ci-no"  value="no"  checked>
            <label for="ci-no">Ù„Ø§</label>
            <input type="radio" name="callIssues" id="ci-yes" value="yes">
            <label for="ci-yes">Ù†Ø¹Ù…</label>
          </div>
        </div>
        <div class="field">
          <label>Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ­Ø¯ØŸ</label>
          <div class="toggle">
            <input type="radio" name="uniIssues" id="ui-no"  value="no"  checked>
            <label for="ui-no">Ù„Ø§</label>
            <input type="radio" name="uniIssues" id="ui-yes" value="yes">
            <label for="ui-yes">Ù†Ø¹Ù…</label>
          </div>
        </div>
      </div>
    </div>

    <button type="submit" class="btn btn-primary" id="submitBtn">
      <div class="spin"></div>
      <span class="btn-txt">âœ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</span>
    </button>

  </form>
</div>

<div id="toast"></div>

<!-- â•â• CONFIG â•â• -->
<script>
  // â–¼â–¼â–¼ Ø¶Ø¹ Ø±Ø§Ø¨Ø· Apps Script Web App Ù‡Ù†Ø§ â–¼â–¼â–¼
  const API_URL = "https://script.google.com/macros/s/AKfycbyOIYbNFsg0cb0JokTnCJlUR97_784tP8Zl9BSlpC16vjgsGv9M3iDmYFAtJcFOoNFpqw/exec";

  // Ù…ÙØªØ§Ø­ sessionStorage Ù„Ø±Ù…Ø² Ø§Ù„Ù…Ø´Ø±ÙØ© (Ø¹Ø´Ø§Ù† Ù…Ø§ ÙŠØªØ¯Ø§Ø®Ù„ Ù…Ø¹ ØµÙØ­Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©)
  const AUTH_STORAGE_KEY = "authKeySupervisor";
</script>

<script>
// â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doLogin() {
  const key = document.getElementById("keyInput").value.trim();
  if (!key) { shakeInput("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø²"); return; }

  // Store ONLY in sessionStorage
  sessionStorage.setItem(AUTH_STORAGE_KEY, key);
  document.getElementById("loginScreen").style.display = "none";
  document.getElementById("mainContent").style.display = "block";

  document.getElementById("loginError").style.display = "none";
}

function shakeInput(msg) {
  const inp = document.getElementById("keyInput");
  inp.classList.add("shake");
  const err = document.getElementById("loginError");
  err.textContent = msg || "Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­";
  err.style.display = "block";
  setTimeout(() => inp.classList.remove("shake"), 400);
}

document.getElementById("keyInput").addEventListener("keydown", e => {
  if (e.key === "Enter") doLogin();
});

// Auto-restore session
(function () {
  if (sessionStorage.getItem(AUTH_STORAGE_KEY)) {
    document.getElementById("loginScreen").style.display = "none";
    document.getElementById("mainContent").style.display = "block";
  }
})();

// â”€â”€ DATE DEFAULT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById("f-date").value = new Date().toISOString().slice(0, 10);

// â”€â”€ VALIDATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setErr(id, show, msg) {
  const inp = document.getElementById("f-" + id);
  const em  = document.getElementById("e-" + id);
  if (inp) inp.classList.toggle("err", show);
  if (em)  { em.classList.toggle("show", show); if (msg) em.textContent = msg; }
}

function validate() {
  let ok = true;
  const req = [["date","Ù…Ø·Ù„ÙˆØ¨"],["branch","Ù…Ø·Ù„ÙˆØ¨"],["agent","Ù…Ø·Ù„ÙˆØ¨"]];
  req.forEach(([id, msg]) => {
    const v = document.getElementById("f-" + id).value.trim();
    setErr(id, !v, msg); if (!v) ok = false;
  });

  const nums = ["total","answered","cbc","cbm","unanswered"];
  const n = {};
  nums.forEach(id => {
    const v = parseFloat(document.getElementById("f-" + id).value);
    n[id] = v;
    if (isNaN(v) || v < 0) { setErr(id, true, "Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­"); ok = false; }
    else setErr(id, false);
  });

  if (!isNaN(n.answered) && !isNaN(n.total) && n.answered > n.total) {
    setErr("answered", true, "ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† â‰¤ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ"); ok = false;
  }
  if (!isNaN(n.unanswered) && !isNaN(n.total) && n.unanswered > n.total) {
    setErr("unanswered", true, "ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† â‰¤ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ"); ok = false;
  }
  return ok;
}

// Real-time cross-field check
["total","answered","unanswered"].forEach(id =>
  document.getElementById("f-" + id).addEventListener("input", () => {
    const t = +document.getElementById("f-total").value;
    const a = +document.getElementById("f-answered").value;
    const u = +document.getElementById("f-unanswered").value;

    if (!isNaN(t) && !isNaN(a)) setErr("answered", a > t, "ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† â‰¤ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ");
    if (!isNaN(t) && !isNaN(u)) setErr("unanswered", u > t, "ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† â‰¤ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ");
  })
);

// â”€â”€ SUBMIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById("reportForm").addEventListener("submit", async e => {
  e.preventDefault();
  if (!validate()) return;

  const authKey = sessionStorage.getItem(AUTH_STORAGE_KEY) || "";
  if (!authKey) {
    showToast("ğŸ”’ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©. Ø£Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„", "err");
    document.getElementById("mainContent").style.display = "none";
    document.getElementById("loginScreen").style.display = "block";
    return;
  }

  const btn = document.getElementById("submitBtn");
  btn.disabled = true; btn.classList.add("loading");

  // âœ… Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ù‡Ù†Ø§ ØµØ§Ø±Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù…Ø§ ÙŠØ³ØªØ®Ø¯Ù…Ù‡ Apps Script/Ø§Ù„Ø´ÙŠØª
  const payload = {
    authKey: authKey,
    Date:                document.getElementById("f-date").value,
    Branch:              document.getElementById("f-branch").value,
    AgentName:           document.getElementById("f-agent").value.trim(),
    TotalCalls:          +document.getElementById("f-total").value,
    AnsweredCalls:       +document.getElementById("f-answered").value,
    UnansweredEOD:       +document.getElementById("f-unanswered").value,
    CallbacksCompleted:  +document.getElementById("f-cbc").value,
    CallbackTimeMinutes: +document.getElementById("f-cbm").value,
    // Ù‡Ø°Ù‡ ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„ÙƒÙ† Ù†Ø«Ø¨ØªÙ‡Ø§ 0
    LateMessages:        0,
    OpenChatsEOD:        0,
    // Ù†Ø®Ù„ÙŠÙ‡Ø§ Yes/No Ù…Ø¨Ø§Ø´Ø±Ø© (ÙˆØ§Ø¶Ø­Ø© Ù„Ù„Ø³ÙƒØ±Ø¨Øª)
    CallIssues:          document.querySelector('input[name=callIssues]:checked').value === "yes" ? "Yes" : "No",
    UnifiedNumberIssues: document.querySelector('input[name=uniIssues]:checked').value === "yes" ? "Yes" : "No",
    Notes:               ""
  };

  try {
await fetch(API_URL, {
  method: "POST",
  mode: "no-cors",
  body: JSON.stringify(payload),
  headers: { "Content-Type":"application/json" }
});

showToast("âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ (ØªØ£ÙƒØ¯ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„ØµÙ ÙÙŠ Ø§Ù„Ø´ÙŠØª)", "ok");
showKPIs(payload);
resetForm();
});

// â”€â”€ SHOW KPIs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showKPIs(d) {
  const total   = d.TotalCalls   || 0;
  const ans     = d.AnsweredCalls || 0;
  const rate    = total > 0 ? (ans / total * 100) : 0;
  const unansCnt= d.UnansweredEOD || 0;
  const unansPct= total > 0 ? (unansCnt / total * 100) : 0;

  const rC = rate >= 90 ? "ok" : rate >= 85 ? "warn" : "bad";
  const uC = unansPct <= 5 ? "ok" : unansPct <= 15 ? "warn" : "bad";

  document.getElementById("kpiRow").innerHTML = `
    <div class="kpi info"><div class="kpi-lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div><div class="kpi-val">${total}</div></div>
    <div class="kpi info"><div class="kpi-lbl">Ù…Ø¬Ø§Ø¨</div><div class="kpi-val">${ans}</div></div>
    <div class="kpi ${rC}"><div class="kpi-lbl">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø±Ø¯</div><div class="kpi-val">${rate.toFixed(1)}%</div></div>
    <div class="kpi ${uC}"><div class="kpi-lbl">ØºÙŠØ± Ù…Ø¬Ø§Ø¨</div><div class="kpi-val">${unansCnt}</div></div>
    <div class="kpi info"><div class="kpi-lbl">Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ§ØµÙ„</div><div class="kpi-val">${d.CallbacksCompleted}</div></div>
  `;

  const alerts = [];
  if (rate < 85)       alerts.push({t:"bad",  m:`âš ï¸ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø±Ø¯ ${rate.toFixed(1)}% â€“ Ø£Ù‚Ù„ Ù…Ù† 85%`});
  else if (rate < 90)  alerts.push({t:"warn", m:`ğŸ’› Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø±Ø¯ ${rate.toFixed(1)}% â€“ Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰`});
  else                 alerts.push({t:"ok",   m:`âœ… Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø±Ø¯ Ù…Ù…ØªØ§Ø²: ${rate.toFixed(1)}%`});

  if (unansPct > 5)    alerts.push({t:"warn", m:`ğŸ“µ Ù†Ø³Ø¨Ø© ØºÙŠØ± Ø§Ù„Ù…Ø¬Ø§Ø¨ ${unansPct.toFixed(1)}% â€“ ØªØ¬Ø§ÙˆØ² 5%`});
  if (d.CallIssues === "Yes")    alerts.push({t:"bad",  m:`ğŸ”´ Ù…Ø´ÙƒÙ„Ø© Ù…ÙØ³Ø¬ÙÙ‘Ù„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª`});
  if (d.UnifiedNumberIssues === "Yes") alerts.push({t:"bad", m:`ğŸ“ Ù…Ø´ÙƒÙ„Ø© Ù…ÙØ³Ø¬ÙÙ‘Ù„Ø© ÙÙŠ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ­Ø¯`});

  document.getElementById("alertsArea").innerHTML = alerts.map(a =>
    `<div class="alert ${a.t}">${a.m}</div>`
  ).join("");

  document.getElementById("kpiStrip").style.display = "block";
}

// â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resetForm() {
  document.getElementById("f-date").value = new Date().toISOString().slice(0,10);
  document.getElementById("f-branch").value = "";
  document.getElementById("f-agent").value  = "";
  ["total","answered","cbc","cbm","unanswered"].forEach(id =>
    document.getElementById("f-" + id).value = 0
  );
  document.getElementById("ci-no").checked = true;
  document.getElementById("ui-no").checked = true;
}

// â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg, type) {
  const t = document.getElementById("toast");
  t.textContent = msg; t.className = type;
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), 4000);
}
</script>
</body>
</html>
